version: 2
models:
- name: dim_customers
  tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - customer_id
  - dbt_utils.expression_is_true:
      expression: email like '%@%'
  columns:
  - name: customer_id
    tests:
    - not_null
    description: Unique identifier for the customer.
  - name: full_name
    description: Customer full name.
  - name: email
    tests:
    - not_null
    - unique
    description: Customer email address.
  - name: phone
    description: Customer phone number.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Customer dimension at customer_id grain.
- name: dim_customer_addresses
  tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - address_id
  columns:
  - name: address_id
    tests:
    - not_null
    description: Unique identifier for the customer address.
  - name: customer_id
    tests:
    - not_null
    - relationships:
        to: ref('dim_customers')
        field: customer_id
    description: Unique identifier for the customer.
  - name: label
    description: Descriptive attribute.
  - name: line_1
    description: Location/address attribute.
  - name: line_2
    description: Location/address attribute.
  - name: city
    description: Location/address attribute.
  - name: state
    description: Location/address attribute.
  - name: country
    description: Location/address attribute.
  - name: postal_code
    description: Location/address attribute.
  - name: latitude
    description: Geographic coordinate.
  - name: longitude
    description: Geographic coordinate.
  - name: is_default
    tests:
    - not_null
    description: Boolean indicator flag.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Customer address dimension at address_id grain.
- name: dim_restaurants
  tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - restaurant_sk
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - restaurant_id
      where: is_current
  - dbt_utils.expression_is_true:
      expression: valid_to is null or valid_to > valid_from
  columns:
  - name: restaurant_sk
    tests:
    - not_null
    description: Surrogate key generated by dbt (stable identifier for the dimension row).
  - name: restaurant_id
    tests:
    - not_null
    description: Unique identifier for the restaurant outlet.
  - name: brand_id
    description: Unique identifier for the restaurant brand.
  - name: brand_name
    description: Descriptive attribute.
  - name: outlet_name
    description: Descriptive attribute.
  - name: city
    description: Location/address attribute.
  - name: delivery_zone
    description: Location/address attribute.
  - name: is_active
    description: Boolean indicator flag.
  - name: valid_from
    tests:
    - not_null
    description: SCD2 validity window boundary (UTC timestamp).
  - name: valid_to
    description: SCD2 validity window boundary (UTC timestamp).
  - name: is_current
    tests:
    - not_null
    description: Boolean indicator flag.
  description: Restaurant dimension (SCD2) at restaurant_id grain with snapshot-based history.
- name: dim_menu_items
  tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - menu_item_sk
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - menu_item_id
      where: is_current
  - dbt_utils.expression_is_true:
      expression: valid_to is null or valid_to > valid_from
  columns:
  - name: menu_item_sk
    tests:
    - not_null
    description: Surrogate key generated by dbt (stable identifier for the dimension row).
  - name: menu_item_id
    tests:
    - not_null
    description: Unique identifier for the menu item.
  - name: restaurant_id
    description: Unique identifier for the restaurant outlet.
  - name: item_name
    description: Descriptive attribute.
  - name: category
    description: Descriptive attribute.
  - name: valid_from
    tests:
    - not_null
    description: SCD2 validity window boundary (UTC timestamp).
  - name: valid_to
    description: SCD2 validity window boundary (UTC timestamp).
  - name: is_current
    tests:
    - not_null
    description: Boolean indicator flag.
  description: Menu item dimension (SCD2) at menu_item_id grain with snapshot-based history.
- name: dim_couriers
  tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - courier_id
  columns:
  - name: courier_id
    tests:
    - not_null
    description: Unique identifier for the courier.
  - name: city
    description: Location/address attribute.
  - name: vehicle
    tests:
    - not_null
    - accepted_values:
        values:
        - BIKE
        - SCOOTER
        - CAR
    description: Courier vehicle type.
  - name: is_active
    tests:
    - not_null
    description: Boolean indicator flag.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Courier dimension at courier_id grain.
- name: dim_currencies
  tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - currency_id
  columns:
  - name: currency_id
    tests:
    - not_null
    description: Unique identifier for the currency.
  - name: currency_code
    tests:
    - not_null
    - unique
    - accepted_values:
        values:
        - AUD
        - INR
        - USD
    description: ISO 4217 three-letter currency code.
  - name: currency_name
    description: Human-readable currency name.
  - name: is_active
    tests:
    - not_null
    description: Boolean indicator flag.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Currency dimension at currency_id grain.
- name: dim_date
  tests:
  - dbt_utils.unique_combination_of_columns:
      combination_of_columns:
      - date_utc
  columns:
  - name: date_utc
    tests:
    - not_null
    description: UTC calendar date derived for partitioning and reporting.
  - name: year_utc
    tests:
    - not_null
    - dbt_utils.accepted_range:
        min_value: 2000
        max_value: 2100
    description: Derived calendar attribute from the UTC date.
  - name: month_utc
    tests:
    - not_null
    - dbt_utils.accepted_range:
        min_value: 1
        max_value: 12
    description: Derived calendar attribute from the UTC date.
  - name: day_utc
    description: Derived calendar attribute from the UTC date.
  - name: day_of_week
    description: Day of week number derived from the UTC date (DuckDB extract(dow)).
  - name: week_of_year
    description: Week number derived from the UTC date (DuckDB extract(week)).
  description: Date dimension built from all observed UTC dates in the warehouse.
