version: 2
models:
- name: stg_raw__customers
  columns:
  - name: customer_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the customer.
  - name: full_name
    description: Customer full name.
  - name: email
    tests:
    - not_null
    - unique
    description: Customer email address.
  - name: phone
    description: Customer phone number.
  - name: created_at
    tests:
    - not_null
    description: Record creation timestamp in the source system.
  description: Staging model for customers. Performs type casting and basic string normalization from the raw source.
- name: stg_raw__customer_addresses
  columns:
  - name: address_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the customer address.
  - name: customer_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__customers')
        field: customer_id
    description: Unique identifier for the customer.
  - name: label
    tests:
    - not_null
    - accepted_values:
        values:
        - HOME
        - WORK
        - OTHER
    description: Descriptive attribute.
  - name: line_1
    description: Location/address attribute.
  - name: line_2
    description: Location/address attribute.
  - name: city
    tests:
    - not_null
    description: Location/address attribute.
  - name: state
    description: Location/address attribute.
  - name: country
    tests:
    - not_null
    description: Location/address attribute.
  - name: postal_code
    description: Location/address attribute.
  - name: latitude
    description: Geographic coordinate.
  - name: longitude
    description: Geographic coordinate.
  - name: is_default
    tests:
    - not_null
    description: Boolean indicator flag.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Staging model for customer delivery addresses. Standardizes address fields and flags from the raw source.
- name: stg_raw__restaurant_brands
  columns:
  - name: brand_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the restaurant brand.
  - name: brand_name
    tests:
    - not_null
    - unique
    description: Descriptive attribute.
  - name: is_active
    tests:
    - not_null
    description: Boolean indicator flag.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Staging model for restaurant brands. Normalizes brand attributes from the raw source.
- name: stg_raw__restaurant_outlets
  columns:
  - name: restaurant_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the restaurant outlet.
  - name: brand_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__restaurant_brands')
        field: brand_id
    description: Unique identifier for the restaurant brand.
  - name: outlet_name
    tests:
    - not_null
    description: Descriptive attribute.
  - name: city
    tests:
    - not_null
    description: Location/address attribute.
  - name: delivery_zone
    tests:
    - not_null
    description: Location/address attribute.
  - name: address_line1
    description: Location/address attribute.
  - name: postal_code
    description: Location/address attribute.
  - name: is_active
    tests:
    - not_null
    description: Boolean indicator flag.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Staging model for restaurant outlets. Normalizes outlet attributes and delivery zone fields from the raw source.
- name: stg_raw__menu_items
  columns:
  - name: menu_item_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the menu item.
  - name: restaurant_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__restaurant_outlets')
        field: restaurant_id
    description: Unique identifier for the restaurant outlet.
  - name: item_name
    tests:
    - not_null
    description: Descriptive attribute.
  - name: category
    tests:
    - not_null
    description: Descriptive attribute.
  - name: price_amount
    tests:
    - not_null
    description: Monetary amount (decimal) in the specified currency.
  - name: is_available
    tests:
    - not_null
    description: Boolean indicator flag.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Staging model for menu items. Normalizes item attributes and pricing fields from the raw source.
- name: stg_raw__couriers
  columns:
  - name: courier_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the courier.
  - name: city
    tests:
    - not_null
    description: Location/address attribute.
  - name: vehicle
    tests:
    - not_null
    - accepted_values:
        values:
        - BIKE
        - SCOOTER
        - CAR
    description: Courier vehicle type.
  - name: is_active
    tests:
    - not_null
    description: Boolean indicator flag.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Staging model for couriers. Normalizes city, vehicle type, and activation flags from the raw source.
- name: stg_raw__orders
  columns:
  - name: order_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the order.
  - name: customer_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__customers')
        field: customer_id
    description: Unique identifier for the customer.
  - name: delivery_address_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__customer_addresses')
        field: address_id
    description: Identifier of the delivery address used for the order.
  - name: restaurant_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__restaurant_outlets')
        field: restaurant_id
    description: Unique identifier for the restaurant outlet.
  - name: currency_id
    tests:
    - relationships:
        to: ref('stg_raw__currencies')
        field: currency_id
    description: Currency identifier for the monetary amounts on the order.
  - name: order_placed_at
    tests:
    - not_null
    description: Event timestamp (stored as timestamptz).
  - name: scheduled_delivery_at
    description: Requested/scheduled delivery timestamp.
  - name: order_date_utc
    description: UTC date derived from the corresponding timestamp.
  - name: order_day
    description: UTC date partition for the raw order record (written during extraction).
  - name: subtotal
    description: Pre-tax, pre-fee order subtotal amount in order currency.
  - name: tax
    description: Monetary amount (decimal) in the specified currency.
  - name: delivery_fee
    description: Monetary amount (decimal) in the specified currency.
  - name: discount
    description: Monetary amount (decimal) in the specified currency.
  - name: total_amount
    description: Final order total amount in order currency.
  - name: payment_method
    tests:
    - not_null
    - accepted_values:
        values:
        - CARD
        - DIGITAL_WALLET
        - CONTACTLESS_NFC
        - CASH
        - PAYPAL
        - BANK_TRANSFER
    description: Payment method used for the order.
  - name: payment_status
    tests:
    - not_null
    - accepted_values:
        values:
        - PENDING
        - AUTHORIZED
        - PAID
        - FAILED
        - REFUNDED
    description: Payment status of the order.
  description: Staging model for order headers. Normalizes identifiers, timestamps, monetary fields, and payment attributes from the raw source.
- name: stg_raw__order_items
  columns:
  - name: order_item_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the order line item.
  - name: order_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__orders')
        field: order_id
    description: Unique identifier for the order.
  - name: menu_item_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__menu_items')
        field: menu_item_id
    description: Unique identifier for the menu item.
  - name: quantity
    tests:
    - not_null
    description: Quantity/count metric.
  - name: unit_price
    tests:
    - not_null
    description: Unit price charged for the menu item on the order line (in order currency).
  - name: line_total
    tests:
    - not_null
    description: Extended line amount for the order line (quantity * unit_price) in order currency.
  - name: order_day
    description: UTC date partition for the raw order item record (written during extraction).
  description: Staging model for order line items. Normalizes quantities and monetary fields from the raw source.
- name: stg_raw__order_status_events
  columns:
  - name: event_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the order status event.
  - name: order_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__orders')
        field: order_id
    description: Unique identifier for the order.
  - name: event_ts
    tests:
    - not_null
    description: Event timestamp (stored as timestamptz).
  - name: event_date_utc
    description: UTC date derived from the corresponding timestamp.
  - name: status
    tests:
    - not_null
    - accepted_values:
        values:
        - PLACED
        - ACCEPTED
        - PREP_START
        - READY_FOR_PICKUP
        - PICKED_UP
        - DELIVERED
        - CANCELED
    description: Order lifecycle status.
  - name: actor
    tests:
    - not_null
    - accepted_values:
        values:
        - SYSTEM
        - RESTAURANT
        - COURIER
        - CUSTOMER
    description: Actor responsible for the status change.
  - name: event_day
    description: UTC date partition for the raw status event record (written during extraction).
  description: Staging model for order status history events. Normalizes lifecycle status and actor fields from the raw source.
- name: stg_raw__delivery_assignments
  columns:
  - name: order_id
    tests:
    - not_null
    - unique
    - relationships:
        to: ref('stg_raw__orders')
        field: order_id
    description: Unique identifier for the order.
  - name: courier_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__couriers')
        field: courier_id
    description: Unique identifier for the courier.
  - name: assigned_at
    tests:
    - not_null
    description: Delivery assignment timestamp or ETA.
  description: Staging model for delivery assignments. Normalizes courier assignment timestamps from the raw source.
- name: stg_raw__refunds
  columns:
  - name: refund_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the refund event.
  - name: order_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__orders')
        field: order_id
    description: Unique identifier for the order.
  - name: refund_ts
    tests:
    - not_null
    description: Event timestamp (stored as timestamptz).
  - name: refund_date_utc
    description: UTC date derived from the corresponding timestamp.
  - name: refund_reason
    tests:
    - not_null
    - accepted_values:
        values:
        - LATE_DELIVERY
        - MISSING_ITEM
        - WRONG_ITEM
        - QUALITY_ISSUE
        - OTHER
    description: Categorized reason for issuing the refund.
  - name: refund_amount
    tests:
    - not_null
    description: Monetary amount (decimal) in the specified currency.
  - name: currency_id
    tests:
    - relationships:
        to: ref('stg_raw__currencies')
        field: currency_id
    description: Currency identifier for the refund amount.
  - name: refund_day
    description: UTC date partition for the raw refund record (written during extraction).
  description: Staging model for refunds. Normalizes refund reason, amount, and timestamps from the raw source.
- name: stg_raw__ratings
  columns:
  - name: rating_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the rating event.
  - name: order_id
    tests:
    - not_null
    - unique
    - relationships:
        to: ref('stg_raw__orders')
        field: order_id
    description: Unique identifier for the order.
  - name: customer_id
    tests:
    - not_null
    - relationships:
        to: ref('stg_raw__customers')
        field: customer_id
    description: Unique identifier for the customer.
  - name: restaurant_rating
    tests:
    - not_null
    description: Field from the upstream model/source.
  - name: comment
    description: Free-text comment/notes from the source.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Staging model for order ratings. Normalizes rating values and text comments from the raw source.
- name: stg_raw__currencies
  columns:
  - name: currency_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the currency.
  - name: currency_code
    tests:
    - not_null
    - unique
    description: ISO 4217 three-letter currency code.
  - name: currency_name
    description: Human-readable currency name.
  - name: is_active
    tests:
    - not_null
    description: Boolean indicator flag.
  - name: created_at
    description: Record creation timestamp in the source system.
  description: Staging model for currencies. Normalizes ISO currency codes and activation flags from the raw source.
- name: stg_raw__fx_rates
  columns:
  - name: fx_rate_id
    tests:
    - not_null
    - unique
    description: Unique identifier for the FX rate observation.
  - name: base_currency_id
    tests:
    - not_null
    description: Currency identifier for the base currency in the FX pair.
  - name: quote_currency_id
    tests:
    - not_null
    description: Currency identifier for the quote currency in the FX pair.
  - name: rate_ts
    tests:
    - not_null
    description: Event timestamp (stored as timestamptz).
  - name: rate_date_utc
    description: UTC date derived from the FX rate timestamp.
  - name: rate
    tests:
    - not_null
    description: FX rate value (quote currency per 1 unit of base currency).
  - name: source
    description: Source system/provider for the FX rate.
  - name: rate_day
    description: UTC date partition for the raw FX rate record (written during extraction).
  description: Staging model for foreign exchange rates. Normalizes currency pairs, rate timestamps, and rate values from the raw source.
